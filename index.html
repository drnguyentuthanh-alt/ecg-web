<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ECG 3D - R·ªëi Lo·∫°n D·∫´n Truy·ªÅn</title>
    <meta name="description" content="App h·ªçc ECG 3D t∆∞∆°ng t√°c cho BS CK1 N·ªôi khoa">
    <meta name="theme-color" content="#1a1a2e">
    <link rel="manifest" href="manifest.json">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- LOADING SCREEN -->
    <div id="loading-screen">
        <div class="loader">
            <div class="heart-pulse"></div>
            <p>ƒêang t·∫£i h·ªá th·ªëng ECG 3D...</p>
        </div>
    </div>

    <!-- MAIN APP -->
    <div id="app" class="hidden">
        <!-- HEADER -->
        <header id="header">
            <div class="header-left">
                <button id="btn-menu" class="icon-btn" aria-label="Menu">
                    <svg viewBox="0 0 24 24"><path d="M3 12h18M3 6h18M3 18h18"/></svg>
                </button>
                <h1>ECG 3D</h1>
                <span class="badge">D·∫´n Truy·ªÅn</span>
            </div>
            <div class="header-right">
                <button id="btn-emergency" class="emergency-btn">
                    <svg viewBox="0 0 24 24"><path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/></svg>
                    CH·∫æ ƒê·ªò TR·ª∞C
                </button>
                <button id="btn-settings" class="icon-btn" aria-label="C√†i ƒë·∫∑t">
                    <svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="3"/><path d="M12 1v4M12 19v4M4.2 4.2l2.8 2.8M17 17l2.8 2.8M1 12h4M19 12h4M4.2 19.8l2.8-2.8M17 7l2.8-2.8"/></svg>
                </button>
            </div>
        </header>

        <!-- SIDEBAR - DANH M·ª§C B√ÄI H·ªåC -->
        <aside id="sidebar" class="sidebar">
            <div class="sidebar-header">
                <h2>Danh M·ª•c B√†i H·ªçc</h2>
                <button id="btn-close-sidebar" class="icon-btn">
                    <svg viewBox="0 0 24 24"><path d="M18 6L6 18M6 6l12 12"/></svg>
                </button>
            </div>
            
            <nav class="lesson-nav">
                <!-- A. R·ªêI LO·∫†N D·∫™N TRUY·ªÄN NHƒ® ‚Äì TH·∫§T -->
                <div class="nav-group">
                    <h3>A. Block Nhƒ©-Th·∫•t</h3>
                    <ul>
                        <li>
                            <button class="lesson-btn" data-lesson="av-block-1">
                                <span class="lesson-icon av1"></span>
                                <span class="lesson-info">
                                    <strong>Block AV ƒë·ªô I</strong>
                                    <small>PR > 200ms</small>
                                </span>
                            </button>
                        </li>
                        <li>
                            <button class="lesson-btn" data-lesson="av-block-2a">
                                <span class="lesson-icon av2a"></span>
                                <span class="lesson-info">
                                    <strong>Block AV ƒë·ªô II - Mobitz I</strong>
                                    <small>Wenckebach</small>
                                </span>
                            </button>
                        </li>
                        <li>
                            <button class="lesson-btn" data-lesson="av-block-2b">
                                <span class="lesson-icon av2b"></span>
                                <span class="lesson-info">
                                    <strong>Block AV ƒë·ªô II - Mobitz II</strong>
                                    <small>Nguy hi·ªÉm</small>
                                </span>
                            </button>
                        </li>
                        <li>
                            <button class="lesson-btn" data-lesson="av-block-3">
                                <span class="lesson-icon av3"></span>
                                <span class="lesson-info">
                                    <strong>Block AV ƒë·ªô III</strong>
                                    <small>Ho√†n to√†n</small>
                                </span>
                            </button>
                        </li>
                    </ul>
                </div>
                
                <!-- B. R·ªêI LO·∫†N D·∫™N TRUY·ªÄN TRONG TH·∫§T -->
                <div class="nav-group">
                    <h3>B. Block Nh√°nh & Ph√¢n Nh√°nh</h3>
                    <ul>
                        <li>
                            <button class="lesson-btn" data-lesson="rbbb">
                                <span class="lesson-icon rbbb"></span>
                                <span class="lesson-info">
                                    <strong>Block Nh√°nh Ph·∫£i (RBBB)</strong>
                                    <small>rsR' ·ªü V1</small>
                                </span>
                            </button>
                        </li>
                        <li>
                            <button class="lesson-btn" data-lesson="lbbb">
                                <span class="lesson-icon lbbb"></span>
                                <span class="lesson-info">
                                    <strong>Block Nh√°nh Tr√°i (LBBB)</strong>
                                    <small>QRS r·ªông V6</small>
                                </span>
                            </button>
                        </li>
                        <li>
                            <button class="lesson-btn" data-lesson="lafb">
                                <span class="lesson-icon lafb"></span>
                                <span class="lesson-info">
                                    <strong>Block Ph√¢n Nh√°nh Tr∆∞·ªõc Tr√°i</strong>
                                    <small>LAFB - Tr·ª•c l·ªách tr√°i</small>
                                </span>
                            </button>
                        </li>
                        <li>
                            <button class="lesson-btn" data-lesson="lpfb">
                                <span class="lesson-icon lpfb"></span>
                                <span class="lesson-info">
                                    <strong>Block Ph√¢n Nh√°nh Sau Tr√°i</strong>
                                    <small>LPFB - Tr·ª•c l·ªách ph·∫£i</small>
                                </span>
                            </button>
                        </li>
                    </ul>
                </div>
                
                <!-- CASE L√ÇM S√ÄNG -->
                <div class="nav-group">
                    <h3>C. Case L√¢m S√†ng</h3>
                    <ul>
                        <li>
                            <button class="lesson-btn case-btn" data-lesson="case-syncope">
                                <span class="lesson-icon case"></span>
                                <span class="lesson-info">
                                    <strong>BN ng·∫•t, m·∫°ch ch·∫≠m</strong>
                                    <small>T∆∞∆°ng t√°c</small>
                                </span>
                            </button>
                        </li>
                    </ul>
                </div>
            </nav>
        </aside>

        <!-- MAIN CONTENT - SPLIT VIEW -->
        <main id="main-content">
            <!-- LEFT: TIM 3D -->
            <section id="panel-3d" class="panel">
                <div class="panel-header">
                    <h2>Tim 3D - H·ªá D·∫´n Truy·ªÅn</h2>
                    <div class="panel-controls">
                        <button id="btn-reset-view" class="ctrl-btn" title="Reset g√≥c nh√¨n">
                            <svg viewBox="0 0 24 24"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></svg>
                        </button>
                        <button id="btn-toggle-labels" class="ctrl-btn active" title="B·∫≠t/t·∫Øt nh√£n">
                            <svg viewBox="0 0 24 24"><path d="M4 7V4h16v3M9 20h6M12 4v16"/></svg>
                        </button>
                    </div>
                </div>
                
                <div id="heart-container">
                    <canvas id="heart-canvas"></canvas>
                    
                    <!-- ƒêI·ªÄU KHI·ªÇN H·ªÜ D·∫™N TRUY·ªÄN -->
                    <div id="conduction-controls">
                        <div class="control-group">
                            <label>
                                <input type="checkbox" id="ctrl-sa" checked>
                                <span class="node-indicator sa"></span>
                                N√∫t xoang (SA)
                            </label>
                            <label>
                                <input type="checkbox" id="ctrl-av" checked>
                                <span class="node-indicator av"></span>
                                N√∫t nhƒ© th·∫•t (AV)
                            </label>
                            <label>
                                <input type="checkbox" id="ctrl-his" checked>
                                <span class="node-indicator his"></span>
                                B√≥ His
                            </label>
                            <label>
                                <input type="checkbox" id="ctrl-rb" checked>
                                <span class="node-indicator rb"></span>
                                Nh√°nh ph·∫£i
                            </label>
                            <label>
                                <input type="checkbox" id="ctrl-lb" checked>
                                <span class="node-indicator lb"></span>
                                Nh√°nh tr√°i
                            </label>
                            <label>
                                <input type="checkbox" id="ctrl-laf" checked>
                                <span class="node-indicator laf"></span>
                                Ph√¢n nh√°nh tr∆∞·ªõc
                            </label>
                            <label>
                                <input type="checkbox" id="ctrl-lpf" checked>
                                <span class="node-indicator lpf"></span>
                                Ph√¢n nh√°nh sau
                            </label>
                        </div>
                        
                        <div class="speed-control">
                            <label for="conduction-speed">T·ªëc ƒë·ªô xung:</label>
                            <input type="range" id="conduction-speed" min="0.1" max="2" step="0.1" value="1">
                            <span id="speed-value">1x</span>
                        </div>
                    </div>
                </div>
                
                <!-- TR·∫†NG TH√ÅI BLOCK -->
                <div id="block-indicator" class="hidden">
                    <div class="block-badge">
                        <span class="block-icon">‚õî</span>
                        <span id="block-location">V·ªã tr√≠ block</span>
                    </div>
                </div>
            </section>

            <!-- RIGHT: ECG 12 CHUY·ªÇN ƒê·∫†O -->
            <section id="panel-ecg" class="panel">
                <div class="panel-header">
                    <h2>ECG 12 Chuy·ªÉn ƒê·∫°o</h2>
                    <div class="panel-controls">
                        <button id="btn-zoom-ecg" class="ctrl-btn" title="Ph√≥ng to ECG">
                            <svg viewBox="0 0 24 24"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35M11 8v6M8 11h6"/></svg>
                        </button>
                        <button id="btn-measure" class="ctrl-btn" title="ƒêo kho·∫£ng c√°ch">
                            <svg viewBox="0 0 24 24"><path d="M2 12h20M12 2v20M2 17l5-5M2 7l5 5M22 17l-5-5M22 7l-5 5"/></svg>
                        </button>
                    </div>
                </div>
                
                <div id="ecg-container">
                    <div id="ecg-grid">
                        <!-- 12 chuy·ªÉn ƒë·∫°o ƒë∆∞·ª£c render b·ªüi JS -->
                        <div class="ecg-row">
                            <div class="ecg-lead" data-lead="I"><canvas></canvas><span>I</span></div>
                            <div class="ecg-lead" data-lead="aVR"><canvas></canvas><span>aVR</span></div>
                            <div class="ecg-lead" data-lead="V1"><canvas></canvas><span>V1</span></div>
                            <div class="ecg-lead" data-lead="V4"><canvas></canvas><span>V4</span></div>
                        </div>
                        <div class="ecg-row">
                            <div class="ecg-lead" data-lead="II"><canvas></canvas><span>II</span></div>
                            <div class="ecg-lead" data-lead="aVL"><canvas></canvas><span>aVL</span></div>
                            <div class="ecg-lead" data-lead="V2"><canvas></canvas><span>V2</span></div>
                            <div class="ecg-lead" data-lead="V5"><canvas></canvas><span>V5</span></div>
                        </div>
                        <div class="ecg-row">
                            <div class="ecg-lead" data-lead="III"><canvas></canvas><span>III</span></div>
                            <div class="ecg-lead" data-lead="aVF"><canvas></canvas><span>aVF</span></div>
                            <div class="ecg-lead" data-lead="V3"><canvas></canvas><span>V3</span></div>
                            <div class="ecg-lead" data-lead="V6"><canvas></canvas><span>V6</span></div>
                        </div>
                        <!-- Rhythm strip -->
                        <div class="ecg-rhythm">
                            <canvas id="rhythm-strip"></canvas>
                            <span>II - Rhythm</span>
                        </div>
                    </div>
                    
                    <!-- ECG ANNOTATIONS -->
                    <div id="ecg-annotations" class="hidden">
                        <div class="annotation pr-interval">
                            <span class="label">PR</span>
                            <span class="value" id="pr-value">--</span>
                        </div>
                        <div class="annotation qrs-duration">
                            <span class="label">QRS</span>
                            <span class="value" id="qrs-value">--</span>
                        </div>
                        <div class="annotation axis">
                            <span class="label">Tr·ª•c</span>
                            <span class="value" id="axis-value">--</span>
                        </div>
                    </div>
                </div>
            </section>
        </main>

        <!-- BOTTOM: GI·∫¢I TH√çCH + LOA ƒê·ªåC -->
        <section id="explanation-panel">
            <div class="explanation-header">
                <div class="lesson-title">
                    <span id="current-lesson-icon" class="lesson-icon normal"></span>
                    <h3 id="current-lesson-title">Ch·ªçn b√†i h·ªçc ƒë·ªÉ b·∫Øt ƒë·∫ßu</h3>
                </div>
                <div class="audio-controls">
                    <button id="btn-play-audio" class="audio-btn" disabled>
                        <svg class="icon-play" viewBox="0 0 24 24"><polygon points="5 3 19 12 5 21 5 3"/></svg>
                        <svg class="icon-pause hidden" viewBox="0 0 24 24"><rect x="6" y="4" width="4" height="16"/><rect x="14" y="4" width="4" height="16"/></svg>
                    </button>
                    <button id="btn-fast-mode" class="speed-btn" title="Nghe nhanh khi tr·ª±c (30-45s)">
                        ‚ö° Nhanh
                    </button>
                    <div class="volume-control">
                        <svg viewBox="0 0 24 24"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/><path d="M15.54 8.46a5 5 0 0 1 0 7.07"/></svg>
                        <input type="range" id="volume" min="0" max="1" step="0.1" value="0.8">
                    </div>
                </div>
            </div>
            
            <div id="explanation-content">
                <div id="step-indicator">
                    <span class="step" data-step="1">1. B√¨nh th∆∞·ªùng</span>
                    <span class="step" data-step="2">2. Ch·∫∑n d·∫´n truy·ªÅn</span>
                    <span class="step" data-step="3">3. Quan s√°t xung ƒëi·ªán</span>
                    <span class="step" data-step="4">4. ECG thay ƒë·ªïi</span>
                    <span class="step" data-step="5">5. K·∫øt lu·∫≠n</span>
                </div>
                
                <div id="explanation-text">
                    <p id="main-explanation">
                        Ch√†o m·ª´ng b·∫°n ƒë·∫øn v·ªõi <strong>ECG 3D - R·ªëi Lo·∫°n D·∫´n Truy·ªÅn</strong>.<br>
                        Ch·ªçn m·ªôt b√†i h·ªçc t·ª´ menu b√™n tr√°i ƒë·ªÉ b·∫Øt ƒë·∫ßu.
                    </p>
                </div>
                
                <!-- M·∫∏O NH·ªö -->
                <div id="mnemonic-box" class="hidden">
                    <div class="mnemonic-header">
                        <span class="mnemonic-icon">üí°</span>
                        <strong>M·∫∏O NH·ªö</strong>
                    </div>
                    <p id="mnemonic-text"></p>
                </div>
            </div>
            
            <!-- ƒêI·ªÄU KHI·ªÇN B∆Ø·ªöC H·ªåC -->
            <div id="lesson-controls">
                <button id="btn-prev-step" class="nav-btn" disabled>
                    <svg viewBox="0 0 24 24"><path d="M15 18l-6-6 6-6"/></svg>
                    Tr∆∞·ªõc
                </button>
                <div class="step-dots">
                    <span class="dot active"></span>
                    <span class="dot"></span>
                    <span class="dot"></span>
                    <span class="dot"></span>
                    <span class="dot"></span>
                </div>
                <button id="btn-next-step" class="nav-btn" disabled>
                    Ti·∫øp
                    <svg viewBox="0 0 24 24"><path d="M9 18l6-6-6-6"/></svg>
                </button>
            </div>
        </section>

        <!-- CH·∫æ ƒê·ªò TR·ª∞C C·∫§P C·ª®U (MODAL) -->
        <div id="emergency-mode" class="modal hidden">
            <div class="modal-content emergency-content">
                <button id="btn-close-emergency" class="close-btn">
                    <svg viewBox="0 0 24 24"><path d="M18 6L6 18M6 6l12 12"/></svg>
                </button>
                
                <div class="emergency-header">
                    <span class="emergency-icon">üö®</span>
                    <h2>CH·∫æ ƒê·ªò TR·ª∞C C·∫§P C·ª®U</h2>
                </div>
                
                <div class="emergency-grid">
                    <!-- Quick cards cho t·ª´ng lo·∫°i block -->
                    <div class="quick-card" data-quick="av-block-3">
                        <div class="quick-3d">
                            <canvas class="mini-heart"></canvas>
                        </div>
                        <div class="quick-info">
                            <h4>Block AV III</h4>
                            <div class="quick-ecg">
                                <img src="assets/ecg-samples/av3-mini.png" alt="AV Block III ECG">
                            </div>
                            <p class="quick-mnemonic">"P M·ªòT NH·ªäP ‚Äì QRS M·ªòT NH·ªäP"</p>
                            <div class="quick-action">
                                <strong>‚ö†Ô∏è X·ª≠ tr√≠:</strong>
                                <span>Atropine 0.5mg IV ‚Üí Pacing t·∫°m th·ªùi</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="quick-card" data-quick="av-block-2b">
                        <div class="quick-3d">
                            <canvas class="mini-heart"></canvas>
                        </div>
                        <div class="quick-info">
                            <h4>Block AV II - Mobitz II</h4>
                            <div class="quick-ecg">
                                <img src="assets/ecg-samples/mobitz2-mini.png" alt="Mobitz II ECG">
                            </div>
                            <p class="quick-mnemonic">"PR KH√îNG ƒê·ªîI ‚Üí R·ª§NG ƒê·ªòT NG·ªòT"</p>
                            <div class="quick-action">
                                <strong>‚ö†Ô∏è X·ª≠ tr√≠:</strong>
                                <span>Theo d√µi s√°t ‚Üí Chu·∫©n b·ªã pacing</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="quick-card" data-quick="rbbb">
                        <div class="quick-3d">
                            <canvas class="mini-heart"></canvas>
                        </div>
                        <div class="quick-info">
                            <h4>Block Nh√°nh Ph·∫£i</h4>
                            <div class="quick-ecg">
                                <img src="assets/ecg-samples/rbbb-mini.png" alt="RBBB ECG">
                            </div>
                            <p class="quick-mnemonic">"NH√ÅNH PH·∫¢I ‚Üí R' NH∆Ø TAI TH·ªé ·ªû V1"</p>
                            <div class="quick-action">
                                <strong>üìã L∆∞u √Ω:</strong>
                                <span>Th∆∞·ªùng l√†nh t√≠nh n·∫øu ƒë∆°n ƒë·ªôc</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="quick-card" data-quick="lbbb">
                        <div class="quick-3d">
                            <canvas class="mini-heart"></canvas>
                        </div>
                        <div class="quick-info">
                            <h4>Block Nh√°nh Tr√°i</h4>
                            <div class="quick-ecg">
                                <img src="assets/ecg-samples/lbbb-mini.png" alt="LBBB ECG">
                            </div>
                            <p class="quick-mnemonic">"NH√ÅNH TR√ÅI ‚Üí V1 √ÇM S√ÇU, V6 R R·ªòNG"</p>
                            <div class="quick-action">
                                <strong>‚ö†Ô∏è X·ª≠ tr√≠:</strong>
                                <span>T√¨m nguy√™n nh√¢n (b·ªánh tim th·ª±c th·ªÉ?)</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- CASE L√ÇM S√ÄNG MODAL -->
        <div id="case-modal" class="modal hidden">
            <div class="modal-content case-content">
                <button id="btn-close-case" class="close-btn">
                    <svg viewBox="0 0 24 24"><path d="M18 6L6 18M6 6l12 12"/></svg>
                </button>
                
                <div class="case-header">
                    <span class="case-icon">üè•</span>
                    <h2>CASE L√ÇM S√ÄNG T∆Ø∆†NG T√ÅC</h2>
                </div>
                
                <div id="case-content">
                    <!-- ƒê∆∞·ª£c render b·ªüi JS -->
                </div>
            </div>
        </div>

        <!-- ECG ZOOM MODAL -->
        <div id="ecg-zoom-modal" class="modal hidden">
            <div class="modal-content ecg-zoom-content">
                <button id="btn-close-zoom" class="close-btn">
                    <svg viewBox="0 0 24 24"><path d="M18 6L6 18M6 6l12 12"/></svg>
                </button>
                <canvas id="ecg-zoom-canvas"></canvas>
                <div id="ecg-zoom-tools">
                    <div class="measurement-info">
                        <span id="zoom-pr">PR: --</span>
                        <span id="zoom-qrs">QRS: --</span>
                        <span id="zoom-qt">QT: --</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- SCRIPTS -->
    <script src="js/lessonData.js"></script>
    <script src="js/heart3d.js"></script>
    <script src="js/ecgRenderer.js"></script>
    <script src="js/audioNarrator.js"></script>
    <script src="js/caseSimulator.js"></script>
    <script src="js/app.js"></script>
    
    <!-- Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('sw.js')
                .then(reg => console.log('SW registered'))
                .catch(err => console.log('SW registration failed:', err));
        }
    </script>
</body>
</html>